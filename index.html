<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Consistency</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/lillyapp/habits/refs/heads/main/3FC2E555-7142-43BE-83DE-E5ED7A123793.png">

  <!-- Lucide -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <style>
    :root {
      --page-padding: 16px;
      --card-height: calc((100svh - 16px*5 - 60px - env(safe-area-inset-bottom)) / 3);
    }

    * {
      margin:0;
      padding:0;
      box-sizing:border-box;
      user-select:none;
      -webkit-user-select:none;
    }

    body {
      margin:0;
      padding:0;
      font-family: "Poppins", sans-serif;
      background:#fff;
      color:#000;
      height:100svh;
      overflow:hidden;
    }

    /* LOGIN */
    #loginScreen {
      position:absolute;
      inset:0;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      padding:20px;
      z-index:20;
      background:#fff;
    }

    @keyframes pulse {
      0% {transform:scale(1);}
      50%{transform:scale(1.06);}
      100%{transform:scale(1);}
    }

    #loginCircle {
      width:30px;
      height:30px;
      background:#000;
      border-radius:50%;
      animation:pulse 2.2s ease-in-out infinite;
    }

    #loginHeadline {
      margin-top:28px;
      font-size:26px;
      font-weight:600;
      text-align:center;
    }

    #loginButtonBar {
      width:100%;
      max-width:400px;
      display:flex;
      gap:14px;
      margin-top:50px;
    }

    .btn {
      flex:1;
      padding:14px;
      border-radius:20px;
      border:none;
      font-size:17px;
      cursor:pointer;
    }

    #btnLogin    {background:#000; color:#fff;}
    #btnRegister {background:#e5e5e5; color:#000;}

    #loginForm {
      width:100%;
      max-width:400px;
      display:none;
      flex-direction:column;
      gap:12px;
      margin-top:30px;
    }

    .login-input {
      padding:12px;
      border:none;
      border-radius:12px;
      background:#e5e5e5;
    }

    #loginError {
      margin-top:12px;
      color:#ef4444;
      font-size:14px;
      display:none;
      text-align:center;
    }

    /* MAIN PAGE (Habit-Klötze) */
    #appPage {
      position:absolute;
      inset:0;
      display:none;
    }

    .page {
      height:100%;
      display:flex;
      flex-direction:column;
      padding:16px;
      padding-bottom:140px;
      gap:16px;
    }

    .cards {
      flex:1;
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    .slot {
      position:relative;
      height:var(--card-height);
      perspective:1200px;
    }

    .card {
      position:absolute;
      inset:0;
      border-radius:24px;
      background:#e4e4e4;
      padding:24px;
      transform-style:preserve-3d;
      cursor:pointer;
      opacity:0;
      transition:transform 0.2s linear;
    }

    .card-face {
      position:absolute;
      inset:0;
      backface-visibility:hidden;
      border-radius:24px;
      padding:24px;
    }

    .front { background:transparent; }

    .back {
      background:#e4e4e4;
      transform:rotateY(180deg);
      display:flex;
      flex-direction:row;
      justify-content:space-between;
      padding:24px;
    }

    .half {
      width:50%;
      display:flex;
      justify-content:center;
      align-items:center;
      font-size:2rem;
      font-weight:800;
      color:#777;
    }

    .card-input {
      position:absolute;
      bottom:24px;
      left:24px;
      width:60%;
      font-size:2rem;
      font-weight:800;
      border:none;
      background:transparent;
      outline:none;
      color:#666;
    }

    .card-input::placeholder { color:#999; }

    .counter {
      position:absolute;
      bottom:24px;
      right:24px;
      background:#fff;
      padding:4px 12px;
      border-radius:999px;
      border:2px solid #000;
      font-size:1.2rem;
      font-weight:700;
      display:none;
    }

    /* Bottom Buttons (Plus/Haus + Stats) */
    .buttons-row {
      position:fixed;
      left:0;
      right:0;
      bottom:0;
      padding:0 16px calc(16px + env(safe-area-inset-bottom));
      height:calc(60px + env(safe-area-inset-bottom));
      background:#fff;
      display:flex;
      gap:12px;
      z-index:9999;
    }

    .btn-half {
      flex:1;
      height:60px;
      border-radius:999px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.5rem;
      border:none;
      cursor:pointer;
    }

    .btn-plus { background:#000; color:#fff; }
    .btn-stats { background:#f3f3f3; border:2px solid #ccc; color:#333; }

    /* Stats View */
    #statsView {
      position:fixed;
      left:0;
      right:0;
      top:100svh;
      bottom:0;
      background:#fff;
      padding:24px;
      padding-bottom:140px;
      overflow-y:auto;
      z-index:50;
    }

    .stats-name { font-size:2rem; font-weight:700; margin-bottom:20px; }
    .stat-bar { width:100%; height:48px; background:#e5e7eb; border-radius:16px; margin-bottom:18px; overflow:hidden; }
    .stat-fill {
      height:100%;
      width:0;
      padding-left:12px;
      display:flex;
      align-items:center;
      font-weight:700;
      border-radius:16px;
      color:#000;
    }
  </style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
  <div id="loginCircle"></div>
  <div id="loginHeadline">Hallo, bitte melde dich an</div>

  <div id="loginButtonBar">
    <button class="btn" id="btnLogin">Login</button>
    <button class="btn" id="btnRegister">Registrieren</button>
  </div>

  <div id="loginForm">
    <input id="loginEmail" class="login-input" placeholder="E-Mail" type="email" />
    <input id="loginPassword" class="login-input" placeholder="Passwort" type="password" />
    <button class="btn" id="loginOkBtn">OK</button>
  </div>

  <div id="loginError"></div>
</div>

<!-- MAIN HABIT PAGE (3 Klötze) -->
<div id="appPage">
  <div class="page">
    <div class="cards">
      <div class="slot" id="slot1"></div>
      <div class="slot" id="slot2"></div>
      <div class="slot" id="slot3"></div>
    </div>
  </div>

  <div class="buttons-row">
    <button class="btn-half btn-plus" id="addBtn" data-mode="main">
      <i data-lucide="plus"></i>
    </button>
    <button class="btn-half btn-stats" id="statsBtn">
      <i data-lucide="bar-chart-2"></i>
    </button>
  </div>

  <div id="statsView">
    <div class="stats-name">Kevin</div>
    <div class="stat-bar"><div class="stat-fill" id="k1"></div></div>
    <div class="stat-bar"><div class="stat-fill" id="k2"></div></div>
    <div class="stat-bar"><div class="stat-fill" id="k3"></div></div>

    <div style="height:40px"></div>

    <div class="stats-name">Hannah</div>
    <div class="stat-bar"><div class="stat-fill" id="h1"></div></div>
    <div class="stat-bar"><div class="stat-fill" id="h2"></div></div>
    <div class="stat-bar"><div class="stat-fill" id="h3"></div></div>
  </div>
</div>

<script>
  // Icons initialisieren
  lucide.createIcons();

  // Supabase Init
  const supabaseClient = supabase.createClient(
    "https://gglgenarpskajkaanknk.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdnbGdlbmFycHNrYWprYWFua25rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwODA2NzAsImV4cCI6MjA3ODY1NjY3MH0.phVPaPpkiXJ0ncbRiBChpVBtY8gv0sm_MjlCJJnaSt4"
  );

  // DOM-Referenzen
  const loginScreen   = document.getElementById("loginScreen");
  const loginForm     = document.getElementById("loginForm");
  const loginError    = document.getElementById("loginError");
  const appPage       = document.getElementById("appPage");
  const btnLogin      = document.getElementById("btnLogin");
  const btnRegister   = document.getElementById("btnRegister");
  const loginOkBtn    = document.getElementById("loginOkBtn");
  const loginEmail    = document.getElementById("loginEmail");
  const loginPassword = document.getElementById("loginPassword");
  const addBtnEl      = document.getElementById("addBtn");
  const statsBtnEl    = document.getElementById("statsBtn");

  const slotOrder = ["slot3","slot2","slot1"];

  let habits      = [];
  let currentUser = null;
  let authMode    = "login";

  const cycleColors = [
    "#ef4444","#f97316","#f59e0b","#eab308","#84cc16","#22c55e",
    "#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1",
    "#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e","#dc2626",
    "#ea580c","#ca8a04","#4d7c0f","#15803d","#047857","#0f766e",
    "#0369a1","#1d4ed8","#4338ca","#6d28d9","#7e22ce","#be185d"
  ];

  function darken(hex, f=0.55) {
    let r = parseInt(hex.slice(1,3),16)*f|0;
    let g = parseInt(hex.slice(3,5),16)*f|0;
    let b = parseInt(hex.slice(5,7),16)*f|0;
    return `rgb(${r},${g},${b})`;
  }

  // ISO-Wochen-Key für Weekly Reset (Client-seitig)
  function getCurrentWeekKey() {
    const now  = new Date();
    const date = new Date(Date.UTC(now.getFullYear(), now.getMonth(), now.getDate()));
    const dayNum = date.getUTCDay() || 7; // Montag=1..Sonntag=7
    date.setUTCDate(date.getUTCDate() + 4 - dayNum);
    const yearStart = new Date(Date.UTC(date.getUTCFullYear(),0,1));
    const weekNo = Math.ceil((((date - yearStart) / 86400000) + 1) / 7);
    return `${date.getUTCFullYear()}-W${String(weekNo).padStart(2,"0")}`;
  }

  async function ensureWeeklyReset(rows) {
    if (!currentUser || !rows || rows.length === 0) return rows;

    const weekKey    = getCurrentWeekKey();
    const storageKey = `consistency_lastWeekReset_${currentUser.id}`;
    const lastWeek   = localStorage.getItem(storageKey);

    if (lastWeek === weekKey) return rows;

    const idsToReset = [];
    rows.forEach(h => {
      const p = h.progress || 0;
      const c = h.color || "#e4e4e4";
      if (p !== 0 || c !== "#e4e4e4") {
        h.progress = 0;
        h.color    = "#e4e4e4";
        idsToReset.push(h.id);
      }
    });

    if (idsToReset.length > 0) {
      const { error } = await supabaseClient
        .from("habits")
        .update({ progress: 0, color: "#e4e4e4" })
        .in("id", idsToReset);

      if (error) console.error("weekly reset error:", error);
    }

    localStorage.setItem(storageKey, weekKey);
    return rows;
  }

  /* -------------------------
     AUTH / LOGIN
  ------------------------- */

  btnLogin.onclick = () => {
    authMode = "login";
    loginForm.style.display = "flex";
    loginError.style.display = "none";
  };

  btnRegister.onclick = () => {
    authMode = "register";
    loginForm.style.display = "flex";
    loginError.style.display = "none";
  };

  loginOkBtn.onclick = async () => {
    loginError.style.display = "none";
    const email    = loginEmail.value.trim();
    const password = loginPassword.value.trim();

    if (!email || !password) {
      loginError.textContent = "Bitte alles ausfüllen.";
      loginError.style.display = "block";
      return;
    }

    let error;
    if (authMode === "login") {
      ({ error } = await supabaseClient.auth.signInWithPassword({ email, password }));
    } else {
      ({ error } = await supabaseClient.auth.signUp({ email, password }));
    }

    if (error) {
      loginError.textContent = error.message;
      loginError.style.display = "block";
      return;
    }

    const { data } = await supabaseClient.auth.getUser();
    currentUser = data.user;

    loginScreen.style.display = "none";
    appPage.style.display     = "block";
    await loadHabitsFromDB();
  };

  // Session-Autologin
  (async () => {
    const { data } = await supabaseClient.auth.getUser();
    if (data.user) {
      currentUser = data.user;
      loginScreen.style.display = "none";
      appPage.style.display     = "block";
      await loadHabitsFromDB();
    }
  })();

  /* -------------------------
     HABITS LADEN & DARSTELLEN
  ------------------------- */

  async function loadHabitsFromDB() {
    if (!currentUser) {
      const { data } = await supabaseClient.auth.getUser();
      currentUser = data.user;
      if (!currentUser) return;
    }

    const { data, error } = await supabaseClient
      .from("habits_active")
      .select("*")
      .eq("user_id", currentUser.id)
      .order("inserted_at", { ascending: true })
      .limit(3);

    if (error) {
      console.error("loadHabitsFromDB error:", error);
      return;
    }

    let rows = data || [];
    rows = await ensureWeeklyReset(rows);
    habits = rows;

    clearAllSlots();

    const baseDelay = 0.0;
    habits.forEach((habit, i) => {
      const delay = baseDelay + (habits.length - 1 - i) * 0.15;
      createCardFromHabit(habit, i, delay);
    });

    refreshAddButtonIcon();
  }

  function clearAllSlots() {
    slotOrder.forEach(id => {
      const slot = document.getElementById(id);
      slot.innerHTML = "";
    });
  }

  function refreshAddButtonIcon() {
    const addBtn = addBtnEl;

    if (addBtn.dataset.mode === "stats") {
      addBtn.innerHTML = '<i data-lucide="house"></i>';
      addBtn.classList.remove("btn-plus");
      addBtn.style.background = "#f3f3f3";
      addBtn.style.color      = "#333";
      addBtn.style.border     = "2px solid #ccc";
      lucide.createIcons();
      return;
    }

    if (habits.length < 3) {
      addBtn.innerHTML = '<i data-lucide="plus"></i>';
      addBtn.classList.add("btn-plus");
      addBtn.style.background = "#000";
      addBtn.style.color      = "#fff";
      addBtn.style.border     = "none";
    } else {
      addBtn.innerHTML = '<i data-lucide="home"></i>';
      addBtn.classList.remove("btn-plus");
      addBtn.style.background = "#f3f3f3";
      addBtn.style.color      = "#333";
      addBtn.style.border     = "2px solid #ccc";
    }
    lucide.createIcons();
  }

  function createCardFromHabit(habit, index, delay=0) {
    const slot = document.getElementById(slotOrder[index]);
    const card = document.createElement("div");
    card.className = "card";

    card.dataset.index    = index;
    card.dataset.habitId  = habit.id;
    card.dataset.goal     = habit.goal     || 0;
    card.dataset.progress = habit.progress || 0;
    card.dataset.color    = habit.color    || "#e4e4e4";

    const isActive = (habit.color && habit.color !== "#e4e4e4");
    card.dataset.active = isActive ? "true" : "false";

    card.innerHTML = `
      <div class="card-face front">
        <input class="card-input" placeholder="Titel eingeben..." />
        <div class="counter"></div>
      </div>
      <div class="card-face back">
        <div class="half" id="gpsArea">
          <i data-lucide="map-pin" style="width:32px;height:32px;color:#777;"></i>
        </div>
        <div class="half" id="numArea">0</div>
      </div>
    `;

    slot.appendChild(card);
    lucide.createIcons();

    const input   = card.querySelector(".card-input");
    const counter = card.querySelector(".counter");
    const gpsArea = card.querySelector("#gpsArea");
    const numArea = card.querySelector("#numArea");

    input.value = habit.title || "";

    const goal = parseInt(card.dataset.goal);
    const prog = parseInt(card.dataset.progress);

    numArea.textContent = goal;
    if (goal > 0) {
      counter.style.display = "block";
      counter.textContent   = prog + "/" + goal;
    }

    if (isActive) {
      card.style.background = habit.color;
      input.style.color     = darken(habit.color);
    } else {
      card.style.background = "#e4e4e4";
      input.style.color     = "#666";
    }

    gsap.fromTo(card, { y:-300, opacity:0 }, {
      y:0,
      opacity:1,
      duration:0.8,
      ease:"back.out(1.7)",
      delay
    });

    attachCardLogic(card);
  }

  /* -------------------------
     CARD-LOGIK
  ------------------------- */

  function attachCardLogic(card) {
    const input   = card.querySelector(".card-input");
    const counter = card.querySelector(".counter");
    const gpsArea = card.querySelector("#gpsArea");
    const numArea = card.querySelector("#numArea");

    let swipeStartX = 0;
    let swipeEndX   = 0;
    let autoFlipTimer = null;

    // Flip per Swipe
    card.addEventListener("touchstart",(e)=>{
      swipeStartX = e.touches[0].clientX;
      clearTimeout(autoFlipTimer);
    });

    card.addEventListener("touchmove",(e)=>{
      swipeEndX = e.touches[0].clientX;
    });

    card.addEventListener("touchend",()=>{
      const dx = swipeEndX - swipeStartX;

      if (dx < -40 && !card.style.transform.includes("180deg")){
        gsap.to(card,{rotationY:180,duration:0.4,ease:"power2.out"});
      }
      if (dx > 40 && card.style.transform.includes("180deg")){
        gsap.to(card,{rotationY:0,duration:0.4,ease:"power2.out"});
      }

      autoFlipTimer = setTimeout(()=>{
        if(card.style.transform.includes("180deg")){
          gsap.to(card,{rotationY:0,duration:0.5,ease:"power2.out"});
        }
      },3000);
    });

    // Goal (Y) einstellen (0–7)
    numArea.addEventListener("click",(e)=>{
      e.stopPropagation();
      let y = parseInt(card.dataset.goal);
      y = (y + 1) % 8;
      card.dataset.goal = y;
      numArea.textContent = y;

      let x = parseInt(card.dataset.progress);
      if (x > y) {
        x = y;
        card.dataset.progress = x;
      }

      if (y > 0) {
        counter.style.display = "block";
        counter.textContent   = x + "/" + y;
      } else {
        counter.style.display = "none";
      }

      saveHabit(card);
    });

    gpsArea.addEventListener("click",(e)=>{
      e.stopPropagation();
      gsap.to(card,{rotationY:0,duration:0.4,ease:"power2.out"});
    });

    // Long Press Color Cycling (nur aktiv)
    let pressTimer = null;
    let pressInterval = null;

    card.addEventListener("touchstart",()=>{
      clearTimeout(pressTimer);
      clearInterval(pressInterval);

      pressTimer = setTimeout(()=>{
        if (card.dataset.active === "true") {
          let i = 0;
          pressInterval = setInterval(()=>{
            const col = cycleColors[i % cycleColors.length];
            card.style.background = col;
            card.dataset.color    = col;
            input.style.color     = darken(col);
            i++;
            saveHabit(card);
          },900);
        }
      },300);
    });

    card.addEventListener("touchend",()=>{
      clearTimeout(pressTimer);
      clearInterval(pressInterval);
    });

    // Titel speichern
    input.addEventListener("blur", ()=> {
      saveHabit(card);
    });
    input.addEventListener("keydown", (e)=>{
      if(e.key==="Enter"){
        e.preventDefault();
        input.blur();
      }
    });

    // Klick-Logik: bis goal hochzählen, dann Reset (Variante B)
    card.addEventListener("click",()=>{
      if(card.style.transform.includes("180deg")) return;
      if(!input.value.trim()) return;

      let x      = parseInt(card.dataset.progress) || 0;
      let y      = parseInt(card.dataset.goal)     || 0;
      let active = card.dataset.active === "true";
      const idx  = parseInt(card.dataset.index);

      if (y === 0) {
        // goal=0: reiner Toggle mit progress 0/1
        if (!active) {
          x = 1;
          active = true;
          const col = cycleColors[idx];
          card.style.background = col;
          card.dataset.color    = col;
          input.style.color     = darken(col);
        } else {
          x = 0;
          active = false;
          card.style.background = "#e4e4e4";
          card.dataset.color    = "#e4e4e4";
          input.style.color     = "#666";
        }
      } else {
        // goal >= 1: bis goal hochzählen, dann kompletter Reset
        if (!active) {
          active = true;
          if (x === 0 && x < y) {
            x = 1;
          }
          const col = cycleColors[idx];
          card.style.background = col;
          card.dataset.color    = col;
          input.style.color     = darken(col);
        } else {
          if (x < y) {
            x += 1;
          } else {
            // Voll erfüllt -> Reset
            x = 0;
            active = false;
            card.style.background = "#e4e4e4";
            card.dataset.color    = "#e4e4e4";
            input.style.color     = "#666";
          }
        }
      }

      card.dataset.progress = x;
      card.dataset.active   = active ? "true" : "false";

      if (y > 0) {
        counter.style.display = "block";
        counter.textContent   = x + "/" + y;
      } else {
        counter.style.display = "none";
      }

      saveHabit(card);
    });
  }

  /* -------------------------
     SPEICHERN IN DB
  ------------------------- */

  async function saveHabit(card) {
    if (!currentUser) return;

    const habitId = card.dataset.habitId;
    const input   = card.querySelector(".card-input");
    const title   = input.value.trim();
    const color   = card.dataset.color || "#e4e4e4";
    const progress = parseInt(card.dataset.progress) || 0;
    const goal     = parseInt(card.dataset.goal)     || 0;

    if (!habitId) return;

    const { error } = await supabaseClient
      .from("habits")
      .update({
        title,
        color,
        progress,
        goal
      })
      .eq("id", habitId);

    if (error) {
      console.error("saveHabit error:", error);
    }
  }

  /* -------------------------
     PLUS / HAUS BUTTON
  ------------------------- */

  addBtnEl.addEventListener("click", async () => {
    if (addBtnEl.dataset.mode === "stats") {
      addBtnEl.dataset.mode = "main";
      gsap.to("#statsView",{top:"100svh",duration:0.6,ease:"power3.in"});
      refreshAddButtonIcon();
      return;
    }

    if (habits.length >= 3) {
      return;
    }

    if (!currentUser) {
      const { data } = await supabaseClient.auth.getUser();
      currentUser = data.user;
      if (!currentUser) return;
    }

    const { data, error } = await supabaseClient
      .from("habits")
      .insert({
        user_id: currentUser.id,
        title: "",
        color: "#e4e4e4",
        progress: 0,
        goal: 0,
        appear_once: false
      })
      .select()
      .single();

    if (error) {
      console.error("insert habit error:", error);
      return;
    }

    habits.push(data);
    const index = habits.length - 1;
    createCardFromHabit(data, index, 0);
    refreshAddButtonIcon();
  });

  /* -------------------------
     STATS
  ------------------------- */

  function renderStats() {
    const statIds = ["k1","k2","k3"];

    // Für Kevin: echte Habits
    statIds.forEach((id, i) => {
      const bar = document.getElementById(id);

      if (!habits[i]) {
        bar.style.width      = "0%";
        bar.style.background = "#e5e7eb";
        bar.textContent      = "";
        return;
      }

      const h = habits[i];
      const title = h.title || "—";
      const color = h.color || "#e5e7eb";
      const x = h.progress || 0;
      const y = h.goal     || 0;

      let percent = 0;
      if (y > 0) {
        if (y === 1) {
          // 1x Aufgaben: erledigt = 100%
          percent = x >= 1 ? 100 : 0;
        } else {
          percent = Math.round((x / y) * 100);
        }
      }

      bar.textContent      = title;
      bar.style.background = color;

      gsap.fromTo(bar, { width:"0%" }, {
        width: percent + "%",
        duration: 1.2,
        ease: "power3.out"
      });
    });

    // Für Hannah: Demo-Balken mit Zufallsbreite
    ["h1","h2","h3"].forEach(id=>{
      const bar = document.getElementById(id);
      gsap.fromTo(bar,{width:"0%"},{
        width:(40+Math.random()*60)+"%",
        duration:1.2,
        ease:"power3.out"
      });
    });
  }

  statsBtnEl.addEventListener("click", () => {
    renderStats();
    addBtnEl.dataset.mode = "stats";
    refreshAddButtonIcon();
    gsap.to("#statsView",{top:0,duration:0.6,ease:"power3.out"});
  });
</script>
</body>
</html>